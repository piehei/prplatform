{% extends "base.html" %}
{% load static i18n %}
{% block title %}Statistics{% endblock %}
{% load django_bootstrap_breadcrumbs %}

{% block breadcrumbs %}
    {{ block.super }}
    {% breadcrumb course.code course.get_absolute_url %}
    {% breadcrumb "Peer-review exercise" ""%}
    {% breadcrumb re.name re.get_absolute_url %}
    {% breadcrumb "Statistics" "" %}
{% endblock %}

{% block css %}
  {{ block.super }}
  <link href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css" rel="stylesheet">
{% endblock css %}

{% block content %}

  <div class="row">
    <div class="col-md-12">
    {% include "../tabs.html" with tab="statistics" object=re %}

      {# include "./_stats_form.html" #}
      <div class="alert alert-primary">
        First column points to an original submission. Second column shows reviews made by that submitter.
        After the second columns comes all averages calculated to numerical questions. Last columns 1 to N show
        reviews made for the original submission in the first column.
      </div>
      <table id="stats-table" class="table table-sm table-hover table-bordered">
        <thead>
          <tr>
            <th scope="col">Submitter</th>
            <th scope="col">Reviews by</th>
            {% for nq in numeric_questions %}
              <th scope="col">Q: {{ nq.text }}</th>
            {% endfor %}
            {% for i in max_review_range %}
              <th scope="col">Reviewer {{ i }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
        {% for row in stats.values %}
          <tr scope="row">
            <td><a href="{{ row.os.get_absolute_url }}">{{ row.os.submitter }}</a></td>

            <td> {% for r in row.reviews_by %}
              <a href="{{ r.reviewed_submission.get_absolute_url }}">
                   {{ r.reviewed_submission.submitter }}
              </a>
                 {% endfor %}
            </td>

            {% for avg in row.avgs %}
              <td>{{ avg | floatformat:2 }}</td>
            {% endfor %}
            {% for review in row.reviews %}
              <td>
                {% if review %}
                  <a href="{{ review.get_absolute_url }}">{{ review.submitter }}</a>
                {% endif %}
              </td>
            {% endfor %}
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>


  <script>
    window.addEventListener('load', function() {
      var table = $('#stats-table').DataTable({
        "paging": false
      });

      $('a.toggle-vis').on( 'click', function (e) {
        e.preventDefault();

        // Get the column API object
        var column = table.column( $(this).attr('data-column') );

        // Toggle the visibility
        column.visible( ! column.visible() );
      });
    });
  </script>

{% endblock %}

{% block }

{% block javascript %}
  {{ block.super }}
  <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>
{% endblock javascript %}

